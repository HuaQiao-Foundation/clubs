import { BrowserRouter as Router, Routes, Route, Navigate } from 'react-router-dom'
import { lazy, Suspense } from 'react'
import ErrorBoundary from './components/ErrorBoundary'
import LoadingFallback from './components/LoadingFallback'
import Footer from './components/Footer'
import RouteTracker from './components/RouteTracker'
import { UpdatePrompt } from './components/UpdatePrompt'
import { OfflineIndicator } from './components/OfflineIndicator'
import './App.css'

// Eager load only the landing page for instant display
import Dashboard from './components/Dashboard'
import AboutPage from './components/AboutPage'

// Lazy load all other pages (loaded on demand)
const SpeakersPage = lazy(() => import('./components/SpeakersPage'))
const MemberDirectory = lazy(() => import('./components/MemberDirectory'))

// Lazy load route components for modal views
const SpeakerDetailRoute = lazy(() => import('./routes/SpeakerDetailRoute'))
const SpeakerEditRoute = lazy(() => import('./routes/SpeakerEditRoute'))
const ServiceProjectsPage = lazy(() => import('./components/ServiceProjectsPage'))
const PartnersPage = lazy(() => import('./components/PartnersPage'))
const TimelineView = lazy(() => import('./components/TimelineView'))
const PhotoGallery = lazy(() => import('./components/PhotoGallery'))
const ImpactPage = lazy(() => import('./components/ImpactPage'))
const SpeakerBureauView = lazy(() => import('./components/SpeakerBureauView'))
const CalendarView = lazy(() => import('./components/CalendarView'))
const EventsListView = lazy(() => import('./components/EventsListView'))
const Availability = lazy(() => import('./components/Availability'))

// Development-only component for testing error boundary
const ErrorTest = import.meta.env.DEV ? lazy(() => import('./components/ErrorTest')) : null

function App() {
  return (
    <ErrorBoundary>
      <Router>
        <RouteTracker />
        <div className="flex flex-col min-h-screen">
          <div className="flex-1">
            <Suspense fallback={<LoadingFallback />}>
              <Routes>
                {/* Dashboard - Home page (eager loaded) */}
                <Route path="/" element={<Dashboard />} />
                <Route path="/about" element={<AboutPage />} />

                {/* Primary Sections (lazy loaded) */}
                <Route path="/members" element={<MemberDirectory />} />
                <Route path="/calendar" element={<CalendarView />} />
                <Route path="/projects" element={<ServiceProjectsPage />} />

                {/* Speakers - Nested routes for hybrid modal + URL routing */}
                <Route path="/speakers" element={<SpeakersPage />}>
                  <Route path=":speakerId" element={<SpeakerDetailRoute />} />
                  <Route path=":speakerId/edit" element={<SpeakerEditRoute />} />
                </Route>

                <Route path="/timeline" element={<TimelineView />} />
                <Route path="/photos" element={<PhotoGallery />} />

                {/* Secondary Sections (lazy loaded) */}
                <Route path="/partners" element={<PartnersPage />} />
                <Route path="/impact" element={<ImpactPage />} />

                {/* Legacy/Other Routes (lazy loaded) */}
                <Route path="/speakers-bureau" element={<SpeakerBureauView />} />
                <Route path="/events-list" element={<EventsListView />} />
                <Route path="/availability" element={<Availability />} />

                {/* Redirects for backwards compatibility */}
                <Route path="/service-projects" element={<Navigate to="/projects" replace />} />
                <Route path="/speaker-bureau" element={<Navigate to="/speakers-bureau" replace />} />

                {/* Development-only route for testing error boundary */}
                {import.meta.env.DEV && ErrorTest && <Route path="/error-test" element={<ErrorTest />} />}
              </Routes>
            </Suspense>
          </div>
          <Footer />
        </div>

        {/* PWA Components */}
        <UpdatePrompt />
        <OfflineIndicator />
      </Router>
    </ErrorBoundary>
  )
}

export default App
